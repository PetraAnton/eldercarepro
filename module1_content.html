<!-- Module 1: Thông tin Cơ bản (Face Sheet) - Vietnamese Version -->
<div class="animate-fade-in">
    <form id="module1-form" class="space-y-8">

        <!-- Two Column Layout for Desktop/Tablet, Single Column for Mobile -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

            <!-- LEFT COLUMN -->
            <div class="space-y-8">

                <!-- Thông tin định danh -->
                <div class="bg-blue-50/50 rounded-3xl p-6 border border-blue-100">
                    <h3 class="font-black text-blue-900 text-sm mb-6 flex items-center gap-2">
                        <i data-lucide="id-card" class="w-5 h-5"></i>
                        Thông tin định danh
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-700 mb-2">Họ và tên <span
                                    class="text-red-500">*</span></label>
                            <input type="text" id="fullName" required
                                class="w-full px-4 py-3 rounded-xl border-2 border-slate-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all outline-none text-sm font-semibold"
                                placeholder="Nguyễn Văn A">
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-slate-700 mb-2">Số CCCD <span
                                        class="text-red-500">*</span></label>
                                <input type="text" id="cccd" required maxlength="12" pattern="[0-9]{12}"
                                    class="w-full px-4 py-3 rounded-xl border-2 border-slate-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all outline-none text-sm font-semibold"
                                    placeholder="001234567890">
                                <p class="text-xs text-slate-400 mt-1">12 chữ số</p>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-700 mb-2">Ngày cấp</label>
                                <input type="date" id="cccdIssueDate"
                                    class="w-full px-4 py-3 rounded-xl border-2 border-slate-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all outline-none text-sm font-semibold">
                            </div>
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-slate-700 mb-2">Nơi cấp</label>
                            <input type="text" id="cccdIssuePlace"
                                class="w-full px-4 py-3 rounded-xl border-2 border-slate-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all outline-none text-sm font-semibold"
                                placeholder="Cục Cảnh sát ĐKQL cư trú và DLQG về dân cư">
                        </div>
                    </div>
                </div>

                <!-- Thông tin cá nhân -->
                <div class="bg-slate-50 rounded-3xl p-6 border border-slate-200">
                    <h3 class="font-black text-slate-800 text-sm mb-6 flex items-center gap-2">
                        <i data-lucide="user" class="w-5 h-5"></i>
                        Thông tin cá nhân
                    </h3>
                    <div class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-slate-700 mb-2">Ngày sinh <span
                                        class="text-red-500">*</span></label>
                                <input type="date" id="dateOfBirth" required
                                    class="w-full px-4 py-3 rounded-xl border-2 border-slate-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all outline-none text-sm font-semibold">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-700 mb-2">Giới tính <span
                                        class="text-red-500">*</span></label>
                                <div class="flex gap-4 mt-3">
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="radio" name="gender" value="male" class="w-4 h-4 text-blue-600">
                                        <span class="text-sm font-semibold">Nam</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="radio" name="gender" value="female" class="w-4 h-4 text-blue-600">
                                        <span class="text-sm font-semibold">Nữ</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="radio" name="gender" value="other" class="w-4 h-4 text-blue-600">
                                        <span class="text-sm font-semibold">Khác</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-slate-700 mb-2">Số điện thoại</label>
                            <input type="tel" id="phone" maxlength="10" pattern="0[0-9]{9}"
                                class="w-full px-4 py-3 rounded-xl border-2 border-slate-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all outline-none text-sm font-semibold"
                                placeholder="0912345678">
                            <p class="text-xs text-slate-400 mt-1">10 chữ số, bắt đầu bằng 0</p>
                        </div>
                    </div>
                </div>

                <!-- Địa chỉ -->
                <div class="bg-slate-50 rounded-3xl p-6 border border-slate-200">
                    <h3 class="font-black text-slate-800 text-sm mb-6 flex items-center gap-2">
                        <i data-lucide="map-pin" class="w-5 h-5"></i>
                        Địa chỉ
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-700 mb-2">Tỉnh/Thành phố <span
                                    class="text-red-500">*</span></label>
                            <select id="city" required
                                class="w-full px-4 py-3 rounded-xl border-2 border-slate-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all outline-none text-sm font-semibold">
                                <option value="">Chọn tỉnh/thành phố</option>
                                <option value="hanoi">Hà Nội</option>
                                <option value="hcm">TP. Hồ Chí Minh</option>
                                <option value="danang">Đà Nẵng</option>
                                <option value="haiphong">Hải Phòng</option>
                                <option value="cantho">Cần Thơ</option>
                            </select>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-slate-700 mb-2">Quận/Huyện</label>
                                <select id="district" disabled
                                    class="w-full px-4 py-3 rounded-xl border-2 border-slate-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all outline-none text-sm font-semibold disabled:bg-slate-100 disabled:text-slate-400">
                                    <option value="">Chọn quận/huyện</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-700 mb-2">Phường/Xã</label>
                                <select id="ward" disabled
                                    class="w-full px-4 py-3 rounded-xl border-2 border-slate-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all outline-none text-sm font-semibold disabled:bg-slate-100 disabled:text-slate-400">
                                    <option value="">Chọn phường/xã</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-slate-700 mb-2">Số nhà, đường</label>
                            <input type="text" id="street"
                                class="w-full px-4 py-3 rounded-xl border-2 border-slate-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all outline-none text-sm font-semibold"
                                placeholder="123 Đường Lê Lợi">
                        </div>
                    </div>
                </div>

            </div>

            <!-- RIGHT COLUMN -->
            <div class="space-y-8">

                <!-- Bảo hiểm Y tế (BHYT) -->
                <div class="bg-green-50/50 rounded-3xl p-6 border border-green-100">
                    <h3 class="font-black text-green-900 text-sm mb-6 flex items-center gap-2">
                        <i data-lucide="shield-plus" class="w-5 h-5"></i>
                        Bảo hiểm Y tế (BHYT)
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-700 mb-2">Số thẻ BHYT</label>
                            <input type="text" id="bhytNumber" maxlength="10" pattern="[A-Z]{2}[0-9]{8}"
                                class="w-full px-4 py-3 rounded-xl border-2 border-slate-200 focus:border-green-500 focus:ring-4 focus:ring-green-100 transition-all outline-none text-sm font-semibold uppercase"
                                placeholder="DN1234567890">
                            <p class="text-xs text-slate-400 mt-1">Format: XX1234567890 (10 ký tự)</p>
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-slate-700 mb-2">Nơi đăng ký KCB ban đầu</label>
                            <input type="text" id="bhytFacility"
                                class="w-full px-4 py-3 rounded-xl border-2 border-slate-200 focus:border-green-500 focus:ring-4 focus:ring-green-100 transition-all outline-none text-sm font-semibold"
                                placeholder="Bệnh viện Đa khoa Trung ương">
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-slate-700 mb-2">Hạn sử dụng thẻ</label>
                                <input type="date" id="bhytExpiry"
                                    class="w-full px-4 py-3 rounded-xl border-2 border-slate-200 focus:border-green-500 focus:ring-4 focus:ring-green-100 transition-all outline-none text-sm font-semibold">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-700 mb-2">Mức hưởng</label>
                                <select id="bhytCoverage"
                                    class="w-full px-4 py-3 rounded-xl border-2 border-slate-200 focus:border-green-500 focus:ring-4 focus:ring-green-100 transition-all outline-none text-sm font-semibold">
                                    <option value="">Chọn mức hưởng</option>
                                    <option value="100">100%</option>
                                    <option value="95">95%</option>
                                    <option value="80">80%</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bảo hiểm Xã hội (BHXH) -->
                <div class="bg-yellow-50/50 rounded-3xl p-6 border border-yellow-100">
                    <h3 class="font-black text-yellow-900 text-sm mb-6 flex items-center gap-2">
                        <i data-lucide="briefcase" class="w-5 h-5"></i>
                        Bảo hiểm Xã hội (BHXH)
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-700 mb-2">Số sổ BHXH</label>
                            <input type="text" id="bhxhNumber" maxlength="10" pattern="[0-9]{10}"
                                class="w-full px-4 py-3 rounded-xl border-2 border-slate-200 focus:border-yellow-500 focus:ring-4 focus:ring-yellow-100 transition-all outline-none text-sm font-semibold"
                                placeholder="1234567890">
                            <p class="text-xs text-slate-400 mt-1">10 chữ số</p>
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-slate-700 mb-2">Trạng thái</label>
                            <select id="retirementStatus"
                                class="w-full px-4 py-3 rounded-xl border-2 border-slate-200 focus:border-yellow-500 focus:ring-4 focus:ring-yellow-100 transition-all outline-none text-sm font-semibold">
                                <option value="">Chọn trạng thái</option>
                                <option value="working">Đang làm việc</option>
                                <option value="retired">Đã nghỉ hưu</option>
                                <option value="none">Không có</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Mức độ phụ thuộc -->
                <div class="bg-slate-50 rounded-3xl p-6 border border-slate-200">
                    <h3 class="font-black text-slate-800 text-sm mb-6 flex items-center gap-2">
                        <i data-lucide="activity" class="w-5 h-5"></i>
                        Mức độ phụ thuộc
                    </h3>
                    <div>
                        <select id="dependencyLevel" required
                            class="w-full px-4 py-3 rounded-xl border-2 border-slate-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all outline-none text-sm font-semibold">
                            <option value="">Chọn mức độ phụ thuộc</option>
                            <option value="independent">Độc lập hoàn toàn</option>
                            <option value="partial">Phụ thuộc một phần</option>
                            <option value="dependent">Phụ thuộc hoàn toàn</option>
                        </select>
                    </div>
                </div>

                <!-- Liên hệ khẩn cấp -->
                <div class="bg-red-50/50 rounded-3xl p-6 border border-red-100">
                    <h3 class="font-black text-red-900 text-sm mb-6 flex items-center gap-2">
                        <i data-lucide="phone-call" class="w-5 h-5"></i>
                        Liên hệ khẩn cấp
                    </h3>
                    <div id="emergency-contacts" class="space-y-4">
                        <div class="emergency-contact-item space-y-3 p-4 bg-white rounded-2xl border border-red-100">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-bold text-slate-700 mb-2">Họ tên</label>
                                    <input type="text"
                                        class="emergency-name w-full px-3 py-2 rounded-lg border-2 border-slate-200 focus:border-red-500 focus:ring-2 focus:ring-red-100 transition-all outline-none text-sm font-semibold"
                                        placeholder="Nguyễn Thị B">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-700 mb-2">Quan hệ</label>
                                    <select
                                        class="emergency-relationship w-full px-3 py-2 rounded-lg border-2 border-slate-200 focus:border-red-500 focus:ring-2 focus:ring-red-100 transition-all outline-none text-sm font-semibold">
                                        <option value="">Chọn quan hệ</option>
                                        <option value="son">Con trai</option>
                                        <option value="daughter">Con gái</option>
                                        <option value="spouse">Vợ/Chồng</option>
                                        <option value="grandchild">Cháu</option>
                                        <option value="other">Khác</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-700 mb-2">Số điện thoại</label>
                                <input type="tel"
                                    class="emergency-phone w-full px-3 py-2 rounded-lg border-2 border-slate-200 focus:border-red-500 focus:ring-2 focus:ring-red-100 transition-all outline-none text-sm font-semibold"
                                    placeholder="0987654321" maxlength="10" pattern="0[0-9]{9}">
                            </div>
                        </div>
                    </div>
                    <button type="button" onclick="addEmergencyContact()"
                        class="mt-4 w-full px-4 py-3 bg-blue-600 text-white rounded-xl font-bold text-sm hover:bg-blue-700 transition-all flex items-center justify-center gap-2">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        Thêm người liên hệ
                    </button>
                </div>

            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t-2 border-slate-100">
            <button type="submit"
                class="flex-1 px-8 py-4 bg-blue-600 text-white rounded-2xl font-black text-sm hover:bg-blue-700 shadow-xl shadow-blue-500/20 transition-all">
                <i data-lucide="save" class="w-4 h-4 inline mr-2"></i>
                Lưu thông tin
            </button>
            <button type="button" onclick="resetForm()"
                class="px-8 py-4 bg-slate-100 text-slate-600 rounded-2xl font-black text-sm hover:bg-slate-200 transition-all">
                <i data-lucide="x" class="w-4 h-4 inline mr-2"></i>
                Hủy
            </button>
        </div>

    </form>
</div>

<script>
    // Module 1 JavaScript Functions
    function addEmergencyContact() {
        const container = document.getElementById('emergency-contacts');
        const newContact = document.createElement('div');
        newContact.className = 'emergency-contact-item space-y-3 p-4 bg-white rounded-2xl border border-red-100 relative';
        newContact.innerHTML = `
        <button type="button" onclick="this.parentElement.remove(); lucide.createIcons();"
            class="absolute top-2 right-2 p-2 text-red-500 hover:bg-red-100 rounded-lg transition-all">
            <i data-lucide="x" class="w-4 h-4"></i>
        </button>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div>
                <label class="block text-xs font-bold text-slate-700 mb-2">Họ tên</label>
                <input type="text" class="emergency-name w-full px-3 py-2 rounded-lg border-2 border-slate-200 focus:border-red-500 focus:ring-2 focus:ring-red-100 transition-all outline-none text-sm font-semibold"
                    placeholder="Nguyễn Văn C">
            </div>
            <div>
                <label class="block text-xs font-bold text-slate-700 mb-2">Quan hệ</label>
                <select class="emergency-relationship w-full px-3 py-2 rounded-lg border-2 border-slate-200 focus:border-red-500 focus:ring-2 focus:ring-red-100 transition-all outline-none text-sm font-semibold">
                    <option value="">Chọn quan hệ</option>
                    <option value="son">Con trai</option>
                    <option value="daughter">Con gái</option>
                    <option value="spouse">Vợ/Chồng</option>
                    <option value="grandchild">Cháu</option>
                    <option value="other">Khác</option>
                </select>
            </div>
        </div>
        <div>
            <label class="block text-xs font-bold text-slate-700 mb-2">Số điện thoại</label>
            <input type="tel" class="emergency-phone w-full px-3 py-2 rounded-lg border-2 border-slate-200 focus:border-red-500 focus:ring-2 focus:ring-red-100 transition-all outline-none text-sm font-semibold"
                placeholder="0987654321" maxlength="10" pattern="0[0-9]{9}">
        </div>
    `;
        container.appendChild(newContact);
        lucide.createIcons();
    }

    function resetForm() {
        if (confirm('Bạn có chắc muốn xóa tất cả dữ liệu đã nhập?')) {
            document.getElementById('module1-form').reset();
        }
    }

    // Cascading Address Dropdowns
    const addressData = {
        'hcm': {
            name: 'TP. Hồ Chí Minh',
            districts: {
                'q1': { name: 'Quận 1', wards: ['Phường Bến Nghé', 'Phường Bến Thành', 'Phường Cô Giang'] },
                'q2': { name: 'Quận 2', wards: ['Phường Thảo Điền', 'Phường An Phú', 'Phường Bình An'] },
                'q3': { name: 'Quận 3', wards: ['Phường 1', 'Phường 2', 'Phường 3'] }
            }
        },
        'hanoi': {
            name: 'Hà Nội',
            districts: {
                'hk': { name: 'Hoàn Kiếm', wards: ['Phường Hàng Bạc', 'Phường Hàng Bài', 'Phường Hàng Bồ'] },
                'bd': { name: 'Ba Đình', wards: ['Phường Điện Biên', 'Phường Đội Cấn', 'Phường Giảng Võ'] }
            }
        }
    };

    document.getElementById('city')?.addEventListener('change', function () {
        const districtSelect = document.getElementById('district');
        const wardSelect = document.getElementById('ward');

        districtSelect.innerHTML = '<option value="">Chọn quận/huyện</option>';
        wardSelect.innerHTML = '<option value="">Chọn phường/xã</option>';
        wardSelect.disabled = true;

        if (this.value && addressData[this.value]) {
            districtSelect.disabled = false;
            const districts = addressData[this.value].districts;
            for (const [key, value] of Object.entries(districts)) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = value.name;
                districtSelect.appendChild(option);
            }
        } else {
            districtSelect.disabled = true;
        }
    });

    document.getElementById('district')?.addEventListener('change', function () {
        const cityValue = document.getElementById('city').value;
        const wardSelect = document.getElementById('ward');

        wardSelect.innerHTML = '<option value="">Chọn phường/xã</option>';

        if (this.value && addressData[cityValue]) {
            wardSelect.disabled = false;
            const wards = addressData[cityValue].districts[this.value].wards;
            wards.forEach(ward => {
                const option = document.createElement('option');
                option.value = ward;
                option.textContent = ward;
                wardSelect.appendChild(option);
            });
        } else {
            wardSelect.disabled = true;
        }
    });

    // Form Submission
    document.getElementById('module1-form')?.addEventListener('submit', function (e) {
        e.preventDefault();

        // Collect form data
        const formData = {
            basicInfo: {
                fullName: document.getElementById('fullName').value,
                cccd: document.getElementById('cccd').value,
                cccdIssueDate: document.getElementById('cccdIssueDate').value,
                cccdIssuePlace: document.getElementById('cccdIssuePlace').value,
                dateOfBirth: document.getElementById('dateOfBirth').value,
                gender: document.querySelector('input[name="gender"]:checked')?.value,
                phone: document.getElementById('phone').value,
                address: {
                    city: document.getElementById('city').value,
                    district: document.getElementById('district').value,
                    ward: document.getElementById('ward').value,
                    street: document.getElementById('street').value
                }
            },
            bhyt: {
                number: document.getElementById('bhytNumber').value,
                facility: document.getElementById('bhytFacility').value,
                expiry: document.getElementById('bhytExpiry').value,
                coverage: document.getElementById('bhytCoverage').value
            },
            bhxh: {
                number: document.getElementById('bhxhNumber').value,
                retirementStatus: document.getElementById('retirementStatus').value
            },
            dependencyLevel: document.getElementById('dependencyLevel').value,
            emergencyContacts: []
        };

        // Collect emergency contacts
        document.querySelectorAll('.emergency-contact-item').forEach(item => {
            formData.emergencyContacts.push({
                name: item.querySelector('.emergency-name').value,
                relationship: item.querySelector('.emergency-relationship').value,
                phone: item.querySelector('.emergency-phone').value
            });
        });

        // Save to LocalStorage
        const patientId = 'patient_001'; // In production, generate unique ID
        localStorage.setItem(`mirabocaresync_${patientId}_module1`, JSON.stringify(formData));

        showToast('Đã lưu thông tin thành công!', 'success');
        console.log('Saved data:', formData);
    });

    // Initialize icons after content loads
    setTimeout(() => lucide.createIcons(), 100);
</script>